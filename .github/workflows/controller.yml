name: Wine Temp Controller

on:
  workflow_dispatch:

permissions:
  contents: read
  issues: write

concurrency:
  group: wine-temp-controller
  cancel-in-progress: true

env:
  GH_STATE_ISSUE_NUMBER: 1

jobs:
  tick:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install deps
        run: |
          sudo apt-get update
          sudo apt-get install -y jq bc

      - name: Make scripts executable
        run: chmod +x ./*.sh

      - name: Run planner and worker
        env:
          SWITCHBOT_TOKEN: ${{ secrets.SWITCHBOT_TOKEN }}
          SWITCHBOT_SECRET: ${{ secrets.SWITCHBOT_SECRET }}
          DEVICE_ID: ${{ secrets.DEVICE_ID }}
          BOT_DEVICE_ID: ${{ secrets.BOT_DEVICE_ID }}
        run: |
          ./planner.sh
          ./worker.sh
